---
layout: post
title: "Mysql"
description: ""
category: 
tags: [mysql, innodb]
---
{% include JB/setup %}
## License
this file is published under [(CC) BY-NC-SA](http://creativecommons.org/licenses/by-nc-sa/3.0/)

## Rescure
yesterday, a power failure caused raid disk drop and mysql innodb trunction failure, after we rebuild the raid, the mysql is down. i did the following step to restore our mysql data.

1. add innodb_force_recovery = 4 to [mysqld] group of /etc/mysql/my.cnf
2. start mysql
3. mysqldump -uroot -p -A > dump.sql
4. cp /var/lib/mysql/ib* ./
5. service mysql stop
6. comment the innodb_force_recovery
7. aptitude purge mysql-server-5.5
8. rm -rf /var/lib/mysql /etc/mysql
9. aptitude install mysql-server-5.5
10. config /etc/mysql/my.cnf
11. mysql -uroot -p < dump.sql
12. enter mysql, flush privileges; grant all privileges on databasename.* to user@'%' identified by 'password';

and data is restored. but i think this is not the best way.

i tried to just drop the corrupted database but failed, and aptitude purge will not remove the setting files, then even installation success, it cannot restore the data, i don't know why, so i just remove all the files related to mysql.
